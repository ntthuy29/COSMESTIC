@model List<COSMESTIC.Models.Data.DeliveryIFMT>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Thông tin giao hàng</h3>

<form method="post" action="@Url.Action("ConfirmOrder", "Order")" id="orderForm">
    <!-- Chọn địa chỉ giao hàng đã lưu -->
    <div class="mb-3">
        <label for="savedAddress" class="form-label">Chọn địa chỉ giao hàng đã lưu</label>
        <select class="form-control" id="savedAddress" name="savedAddress" onchange="fillAddress(this)">
            <option value="">Chọn địa chỉ</option>
            @if (Model != null && Model.Any())
            {
                @foreach (var address in Model)
                {
                    <option value="@address.deliveryID">@address.deliveryName - @address.deliveryAddress</option>
                }
            }
            else
            {
                <option disabled>Không có địa chỉ giao hàng nào</option>
            }
        </select>
        <div id="savedAddressError" style="color: red; display: none;">Vui lòng chọn địa chỉ giao hàng.</div>
    </div>

    <div class="mb-3">
        <label for="fullName" class="form-label">Họ và tên</label>
        <input type="text" class="form-control" id="fullName" name="fullName" />
        <div id="fullNameError" style="color: red; display: none;">Họ và tên không được để trống.</div>
    </div>

    <div class="mb-3">
        <label for="address" class="form-label">Địa chỉ giao hàng</label>
        <input type="text" class="form-control" id="address" name="address" />
        <div id="addressError" style="color: red; display: none;">Địa chỉ giao hàng không được để trống.</div>
    </div>

    <div class="mb-3">
        <label for="phoneNumber" class="form-label">Số điện thoại</label>
        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" />
        <div id="phoneNumberError" style="color: red; display: none;">Số điện thoại không được để trống.</div>
    </div>
    <button type="submit" class="btn btn-primary">Xác nhận và đặt hàng</button>
</form>

<script>
    // Hàm để tự động điền các trường thông tin khi chọn địa chỉ
    function fillAddress(selectElement) {
        var selectedAddressId = selectElement.value;

        if (selectedAddressId) {
            var deliveryAddresses = @Html.Raw(Json.Serialize(Model));
            var selectedAddress = deliveryAddresses.find(address => address.deliveryID == selectedAddressId);

            if (selectedAddress) {
                document.getElementById("fullName").value = selectedAddress.deliveryName;
                document.getElementById("address").value = selectedAddress.deliveryAddress;
                document.getElementById("phoneNumber").value = selectedAddress.deliveryPhone;
            }
        }
    }

    // Hàm kiểm tra dữ liệu trước khi gửi form
    document.getElementById("orderForm").addEventListener("submit", function(event) {
        let isValid = true;

    const savedAddress = document.getElementById("savedAddress").value.trim();
    const fullName = document.getElementById("fullName").value.trim();
    const address = document.getElementById("address").value.trim();
    const phoneNumber = document.getElementById("phoneNumber").value.trim();

    document.getElementById("savedAddressError").style.display = "none";
    document.getElementById("savedAddress").classList.remove("is-invalid");

    if (savedAddress === "") {
        if (fullName === "") {
            isValid = false;
            document.getElementById("fullNameError").style.display = "block";
            document.getElementById("fullName").classList.add("is-invalid");
        } else {
            document.getElementById("fullNameError").style.display = "none";
            document.getElementById("fullName").classList.remove("is-invalid");
        }

        if (address === "") {
            isValid = false;
            document.getElementById("addressError").style.display = "block";
            document.getElementById("address").classList.add("is-invalid");
        } else {
            document.getElementById("addressError").style.display = "none";
            document.getElementById("address").classList.remove("is-invalid");
        }

        if (phoneNumber === "") {
            isValid = false;
            document.getElementById("phoneNumberError").style.display = "block";
            document.getElementById("phoneNumber").classList.add("is-invalid");
        } else {
            document.getElementById("phoneNumberError").style.display = "none";
            document.getElementById("phoneNumber").classList.remove("is-invalid");
        }
    } else {
        // Nếu đã chọn địa chỉ đã lưu, thì các trường fullName, address, phoneNumber có thể để trống hoặc điền tự do, bạn có thể bỏ validate ở đây nếu muốn
        document.getElementById("fullNameError").style.display = "none";
        document.getElementById("addressError").style.display = "none";
        document.getElementById("phoneNumberError").style.display = "none";

        document.getElementById("fullName").classList.remove("is-invalid");
        document.getElementById("address").classList.remove("is-invalid");
        document.getElementById("phoneNumber").classList.remove("is-invalid");
    }

    if (!isValid) {
        event.preventDefault();
    }
    });
</script>
